.language eTS

.record std.core.Object
.record A {}
.record B {
    i32 bar
    i64 baz
}
.record C {
    i32 foo
}

.function i64 A.baz(A a0) <access.function=public> {
    ldai.64 42
    return.64
}

.function void C.bar(C a0, i32 a1) <access.function=public> {
    mov.obj v0, a0
    lda a1
    stobj v0, C.foo
    return.void
}

.union_field i32 bar
.union_field i64 baz

.function i32 test(std.core.Object a0, std.core.Object a1) {
    ets.ldobj.name.64 a0, baz
    i64toi32
    movi v0, 5
    add2 v0
    ets.stobj.name a1, bar
    return
}

.function i32 main() {
    newobj v0, A
    newobj v1, B
    newobj v2, C
    ldai.64 6
    stobj.64 v1, B.baz
    call.short test, v0, v1
    ldobj v1, B.bar
    movi v3, 47
    jne v3, error1
    call.short test, v1, v2
    ldobj v2, C.foo
    movi v3, 11
    jne v3, error2
    call.short test, v0, v2
    ldobj v2, C.foo
    movi v3, 47
    jne v3, error3
    call.short test, v1, v1
    ldobj v1, B.bar
    movi v3, 11
    jne v3, error4
    ldai 0
    return
error1:
    ldai 1
    return
error2:
    ldai 2
    return
error3:
    ldai 3
    return
error4:
    return
}
